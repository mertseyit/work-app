generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}
model User {
  id              String   @id 
  email           String   @unique @db.VarChar(255)
  firstName       String?  @db.VarChar(50)
  lastName        String?  @db.VarChar(50)
  imageUrl        String?  @db.VarChar(500)
  
  transactions    Transaction[] //many to many 
  categories      Category[] //many to many 
  clients         Client[]
  projects        Project[]
  revisions       Revision[]
  tasks           Task[]
  noteLists       NoteList[]
  notes           Note[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("users")
}

//Ä°ÅŸlem kategorisi
model Category {
  id      String          @id @default(uuid())
  name    String          @db.VarChar(50)
  type    TransactionType
  
  userId  String
  user    User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  transactions Transaction[] //many to many 

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@unique([userId, name, type])
  @@map("categories")
}

//finansal yapÄ±lan iÅŸlem
model Transaction {
  id          String          @id @default(uuid())
  amount      Decimal         @db.Decimal(10, 2)
  type        TransactionType
  date        DateTime
  description String?         @db.VarChar(500)
  title       String          @db.VarChar(100)
  userId      String
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Ä°liÅŸki: Hangi kategori?
  categoryId  String
  category    Category        @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@map("transactions")
}



// 1. MÃœÅžTERÄ° / KURUM (CLIENT)
model Client {
  id          String   @id @default(uuid())
  name        String   @db.VarChar(100) // Kurum/KiÅŸi AdÄ±
  description String?  @db.VarChar(1000) // AÃ§Ä±klama
  logo        String?  @db.VarChar(500) // Logo URL (Åžimdilik null)
  
  // Ä°liÅŸkiler
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  projects    Project[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("clients")
}

// 2. PROJE (PROJECT)
model Project {
  id          String        @id @default(uuid())
  name        String        @db.VarChar(150)
  description String?       @db.VarChar(2000)
  
  // Tarihler
  startDate   DateTime      @default(now()) // SeÃ§ilmezse o anÄ±n tarihi
  endDate     DateTime     // Opsiyonel deadline
  
  // Durumlar
  status        ProjectStatus @default(WAITING)
  paymentStatus PaymentStatus @default(UNPAID)
  
  // Finansal
  price         Decimal       @db.Decimal(10, 2)
  paidAmount    Decimal       @default(0) @db.Decimal(10, 2)
  // Teknik
  techStack     String[]      @db.VarChar(50) // Ã–rn: ["Next.js", "Prisma", "Tailwind"]
  category      String?       @db.VarChar(50) // Ã–rn: "E-Ticaret", "Kurumsal Site"
  notes         Note[]
  // Ä°liÅŸkiler
  clientId    String
  client      Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  
  userId      String
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Alt Tablolar
  revisions   Revision[]
  tasks       Task[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@map("projects")
}

// 3. REVÄ°ZELER (REVISIONS)
// MÃ¼ÅŸteriden gelen deÄŸiÅŸiklik istekleri

model Revision {
  id          String   @id @default(uuid())
  title       String   @db.VarChar(200)
  description String?  @db.VarChar(1000) // Link veya notlar buraya
  
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("revisions")
}

model Task {
  id          String      @id @default(uuid())
  title       String      @db.VarChar(200)
  order       Int         @default(0) // Kanban'da kart sÄ±rasÄ±nÄ± tutmak iÃ§in kritik!

  //kanban grafik yapÄ±sÄ± iÃ§in burasÄ± TaskStatus tÃ¼rÃ¼nde atandÄ±.  
  status      TaskStatus  @default(TODO) 
  
  projectId   String
  project     Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)

  userId   String
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@map("tasks")
}

model NoteList {
  id          String   @id @default(uuid())
  title       String   @db.VarChar(100)
  description String?  @db.VarChar(500)
  color       String   @default("#2563eb") @db.VarChar(20) // Default: Blue
  
  // Ä°liÅŸkiler
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  notes       Note[]   // Bu listeye ait notlar

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("note_lists")
}

// 2. NOTLAR (GÃ¶revler)
model Note {
  id          String   @id @default(uuid())
  title       String   @db.VarChar(500)
  
  isImportant Boolean  @default(false)
  isCompleted Boolean  @default(false)
  
  // ðŸ“Œ HATIRLATICI (Remind Me) - Tek seferlik bildirim
  remindAt    DateTime? // HatÄ±rlatÄ±cÄ± tarihi ve saati
  
  // ðŸ“Œ SON TARÄ°H (Due Date) - GÃ¶revin bitiÅŸ tarihi
  dueDate     DateTime? // Teslim tarihi
  
  // ðŸ“Œ TEKRARLAMA (Repeat) - GÃ¶rev tamamlandÄ±ÄŸÄ±nda yeniden oluÅŸtur
  recurrenceType     RecurrenceType?
  recurrenceInterval Int?            @default(1) // Her kaÃ§ gÃ¼nde/haftada bir

  listId      String?
  list        NoteList? @relation(fields: [listId], references: [id], onDelete: Cascade)
  
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  projectId   String?
  project     Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("notes")
}

// Tekrarlama TÃ¼rleri (Microsoft To-Do ile aynÄ±)
enum RecurrenceType {
  DAILY       // Her gÃ¼n
  WEEKDAYS    // Hafta iÃ§i her gÃ¼n (Pzt-Cum)
  WEEKLY      // Her hafta
  MONTHLY     // Her ay
  YEARLY      // Her yÄ±l
  CUSTOM      // Ã–zel (interval ile birlikte)
}

// Kanban SÃ¼tunlarÄ± iÃ§in Enum
enum TaskStatus {
  TODO          // YapÄ±lacaklar
  IN_PROGRESS   // Ä°ÅŸlemde 
  DONE          // TamamlandÄ±
}

// ENUMLAR (Standart Veri Ä°Ã§in)
enum ProjectStatus {
  WAITING           // Beklemede
  IN_PROGRESS       // Devam Ediyor (devam ediyor anlamÄ±nda deÄŸil, Ã§alÄ±ÅŸÄ±lÄ±yor anlamÄ±nda kullanÄ±lÄ±yor.)
  COMPLETED         // TamamlandÄ±
  CANCELLED         // Ä°ptal
  PAUSED            // DuraklatÄ±ldÄ±
  REVISION_REQUEST  // Revize Bekleniyor
}

enum PaymentStatus {
  UNPAID    // Ã–deme Bekliyor
  PARTIAL   // KÄ±smi Ã–deme
  PAID      // Ã–dendi
}

// ENUM: Sabit deÄŸerler iÃ§in
enum TransactionType {
  INCOME
  EXPENSE
}