generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}
model User {
  id              String   @id 
  email           String   @unique @db.VarChar(255)
  firstName       String?  @db.VarChar(50)
  lastName        String?  @db.VarChar(50)
  imageUrl        String?  @db.VarChar(500)
  
  transactions    Transaction[] //many to many 
  categories      Category[] //many to many 
  clients         Client[]
  projects        Project[]
  revisions       Revision[]
  tasks           Task[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("users")
}

//İşlem kategorisi
model Category {
  id      String          @id @default(uuid())
  name    String          @db.VarChar(50)
  type    TransactionType
  
  userId  String
  user    User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  transactions Transaction[] //many to many 

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@unique([userId, name, type])
  @@map("categories")
}

//finansal yapılan işlem
model Transaction {
  id          String          @id @default(uuid())
  amount      Decimal         @db.Decimal(10, 2)
  type        TransactionType
  date        DateTime
  description String?         @db.VarChar(500)
  title       String          @db.VarChar(100)
  userId      String
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  // İlişki: Hangi kategori?
  categoryId  String
  category    Category        @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@map("transactions")
}



// 1. MÜŞTERİ / KURUM (CLIENT)
model Client {
  id          String   @id @default(uuid())
  name        String   @db.VarChar(100) // Kurum/Kişi Adı
  description String?  @db.VarChar(1000) // Açıklama
  logo        String?  @db.VarChar(500) // Logo URL (Şimdilik null)
  
  // İlişkiler
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  projects    Project[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("clients")
}

// 2. PROJE (PROJECT)
model Project {
  id          String        @id @default(uuid())
  name        String        @db.VarChar(150)
  description String?       @db.VarChar(2000)
  
  // Tarihler
  startDate   DateTime      @default(now()) // Seçilmezse o anın tarihi
  endDate     DateTime     // Opsiyonel deadline
  
  // Durumlar
  status        ProjectStatus @default(WAITING)
  paymentStatus PaymentStatus @default(UNPAID)
  
  // Finansal
  price         Decimal       @db.Decimal(10, 2)
  paidAmount    Decimal       @default(0) @db.Decimal(10, 2)
  // Teknik
  techStack     String[]      @db.VarChar(50) // Örn: ["Next.js", "Prisma", "Tailwind"]
  category      String?       @db.VarChar(50) // Örn: "E-Ticaret", "Kurumsal Site"
  // İlişkiler
  clientId    String
  client      Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  
  userId      String
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Alt Tablolar
  revisions   Revision[]
  tasks       Task[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@map("projects")
}

// 3. REVİZELER (REVISIONS)
// Müşteriden gelen değişiklik istekleri

//TODO (mert): userId alanı gerekiyor.
model Revision {
  id          String   @id @default(uuid())
  title       String   @db.VarChar(200)
  description String?  @db.VarChar(1000) // Link veya notlar buraya
  
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("revisions")
}

model Task {
  id          String      @id @default(uuid())
  title       String      @db.VarChar(200)
  order       Int         @default(0) // Kanban'da kart sırasını tutmak için kritik!

  //kanban grafik yapısı için burası TaskStatus türünde atandı.  
  status      TaskStatus  @default(TODO) 
  
  projectId   String
  project     Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)

  userId   String
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@map("tasks")
}

// Kanban Sütunları için Enum
enum TaskStatus {
  TODO          // Yapılacaklar
  IN_PROGRESS   // İşlemde 
  DONE          // Tamamlandı
}

// ENUMLAR (Standart Veri İçin)
enum ProjectStatus {
  WAITING           // Beklemede
  IN_PROGRESS       // Devam Ediyor (devam ediyor anlamında değil, çalışılıyor anlamında kullanılıyor.)
  COMPLETED         // Tamamlandı
  CANCELLED         // İptal
  PAUSED            // Duraklatıldı
  REVISION_REQUEST  // Revize Bekleniyor
}

enum PaymentStatus {
  UNPAID    // Ödeme Bekliyor
  PARTIAL   // Kısmi Ödeme
  PAID      // Ödendi
}

// ENUM: Sabit değerler için
enum TransactionType {
  INCOME
  EXPENSE
}